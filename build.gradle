plugins {
	id 'fabric-loom' version '1.7-SNAPSHOT'
	id 'maven-publish'
}

version = project.mod_version
group = project.maven_group

base {
	archivesName = project.archives_base_name
}

repositories {
	// Add repositories to retrieve artifacts from in here.
	// These repositories will be checked when looking for dependencies and transitives.
	// A detailed explanation of how we find dependencies can be found here:
	// https://docs.gradle.org/current/userguide/dependency_resolution.html#sub:dependency_resolution_order

	// Minecraft's maven repository to get official libraries and resources
	mavenCentral()

	// Fabric's maven repository
	maven { url 'https://maven.fabricmc.net/' }

	// Maven repository for Fabric's stable snapshots
	maven { url 'https://maven.fabricmc.net/snapshots' }
}

dependencies {
	// To change the versions of Forge and Minecraft, see the gradle.properties file
	minecraft 'com.mojang:minecraft:1.21.5'
	mappings loom.layered()
	modImplementation 'net.fabricmc:fabric-loader:' + project.loader_version
	modImplementation 'net.fabricmc.fabric-api:fabric-api:' + project.fabric_version
}

processResources {
	inputs.property 'version', project.version
	replacement 'MOD_VERSION', project.version
}

tasks.withType(JavaCompile).configureEach {
	it.options.encoding = 'UTF-8'
	// Minecraft 1.21.5 (and 1.17+) requires Java 21.
	// Loom will automatically target Java 21 for you. Currently, you can't use newer Java versions.
	it.options.release = 21
}

java {
	// Still target Java 17 for toolchain because loom will handle the runtime target automatically
	def javaVersion = 17
	toolchain {
		languageVersion = JavaLanguageVersion.of(javaVersion)
	}
	// Loom will automatically add sources that generate if the build is successful
	withSourcesJar()
}

jar {
	from('LICENSE') {
		rename { "${it}_${base.archivesName.get()}" }
	}
}

// Configure the maven publication
publishing {
	publications {
		mavenJava(MavenPublication) {
			from components.java
		}
	}

	// See https://docs.gradle.org/current/userguide/publishing_maven.html for information on how to set up publishing.
	repositories {
		// Add repositories to publish to here. Publishing to a local maven repository is useful for testing.
		// mavenLocal()
	}
}
